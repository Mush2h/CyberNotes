# Metasploit

## Initial Configuration

The first time we use Metasploit, we need to create the database structure. To do this, we first need to start the database management system, which is PostgreSQL.

### Starting PostgresSQL Service

We start the service:

```shell 
service postgresql start
```

We create the database structure using the following command:
```shell
msfdb init
```

We check the status with the following command:
```shell
msfconsole -q -x db_status
```

If everything has gone well, you should see the following output:

```shell
[*] Connected to msf.Connection type: postgresql
```

### Workspace Management

We can create workspaces to organize the machines we are auditing:

```shell

#Workspace help
workspace -h 

#Create workspace
workspace -a <nombre>
workspace -a maquina1

#List workspaces
workspace
```

## Nmap Sacanning in Metasploit

### Automatic Scan
We have the option to start an Nmap scan directly from Metasploit using the following command:

```shell
db_nmap -sP <ip>
```

The devices will be automatically added to the database. We can view the added hosts with the hosts command:

```shell
hosts
```

#### Example output:

```shell
Hosts                                                                                                                                                                                                                                       
=====                                                                                                                                                                                                                                                                                                                                                                                                  
address         mac                name  os_name  os_flavor  os_sp  purpose  info  comments                                                                                                                                                 
-------         ---                ----  -------  ---------  -----  -------  ----                                                                                                                                                  
192.168.37.136  00:0C:29:0A:E6:45                                                                                                                                                                                                           
         
```

### Manual Scan

First, we perform the scan and save it in XML format to import it into Metasploit:

```shell
nmap -p- -sS -O 192.168.37.136 --min-rate 9000 -oX nmap_result.xml
```

From Metasploit, we import it as follows:

```shell
msf6 > db_import /home/kali/Desktop/resultado_nmap.xml
```

We can verify the imported services with the following option:
```shell
msf6> services
```

This will display all the ports found on the machine.