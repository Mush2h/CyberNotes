#!/bin/bash

# Descripción: Este script monitorea y muestra en tiempo real los cambios en los procesos en ejecución.
# Es útil para detectar procesos nuevos o terminados, lo que puede ser relevante en tareas de post-explotación
# o análisis de comportamiento del sistema. Filtra procesos comunes para reducir ruido en la salida.

# Función para manejar la interrupción con Ctrl+C
function ctrl_c() {
    echo -e "\n\n [!] Saliendo... \n"
    tput cnorm  # Restaurar la visibilidad normal del cursor
    exit 1
}

# Capturar la señal de Ctrl+C y llamar a la función ctrl_c
trap ctrl_c SIGINT

# Almacenar la lista inicial de procesos
old_process=$(ps -eo user,pid,command)

# Ocultar el cursor
tput civis

# Bucle principal para monitorear continuamente los procesos
while true; do 
    # Obtener la lista actual de procesos
    new_process=$(ps -eo user,pid,command)
    
    # Comparar las listas de procesos, filtrando las entradas comunes
    diff <(echo "$old_process") <(echo "$new_process") | grep "[\>\<]" | grep -vE "command|kworker|procmon|ps|diff|grep|bash"
    
    # Actualizar la lista de procesos antiguos para la próxima iteración
    old_process=$new_process
    
    # Pausa breve para reducir el uso de CPU
    sleep 1
done

